<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Param√®tres - Interfone Odoo Connector</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 550px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 30px;
      text-align: center;
      color: white;
    }

    .header h1 {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .status {
      display: inline-block;
      padding: 8px 16px;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.2);
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .status.connected {
      background: rgba(76, 217, 100, 0.3);
    }

    .status.disconnected {
      background: rgba(255, 69, 58, 0.3);
    }

    .content {
      padding: 30px;
    }

    .section {
      margin-bottom: 30px;
    }

    .section-title {
      font-size: 16px;
      font-weight: 600;
      color: #333;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
    }

    .section-title svg {
      width: 20px;
      height: 20px;
      margin-right: 8px;
      fill: #764ba2;
    }

    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      font-size: 14px;
      color: #666;
      margin-bottom: 8px;
      font-weight: 500;
    }

    input {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 14px;
      transition: all 0.3s ease;
      outline: none;
    }

    input:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    input:disabled {
      background: #f5f5f5;
      cursor: not-allowed;
    }

    .help-text {
      font-size: 12px;
      color: #999;
      margin-top: 5px;
    }

    .buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    button {
      flex: 1;
      padding: 14px 24px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      outline: none;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
    }

    .btn-secondary {
      background: #f0f0f0;
      color: #666;
    }

    .btn-secondary:hover:not(:disabled) {
      background: #e0e0e0;
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .alert {
      padding: 12px 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      font-size: 14px;
      display: none;
    }

    .alert.show {
      display: block;
    }

    .alert.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .alert.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .loader {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid #f3f3f3;
      border-top: 2px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-left: 10px;
      vertical-align: middle;
      display: none;
    }

    .loader.show {
      display: inline-block;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .test-call {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #e0e0e0;
      text-align: center;
    }

    .btn-test {
      background: #ff3b30;
      color: white;
      padding: 10px 20px;
      font-size: 13px;
    }

    .btn-test:hover {
      background: #ff1f14;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Interfone Odoo Connector</h1>
      <div class="status" id="status">
        ‚ùå D√©connect√©
      </div>
    </div>

    <div class="content">
      <div class="alert" id="alert"></div>

      <div class="section">
        <h2 class="section-title">
          <svg viewBox="0 0 24 24">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
          </svg>
          Configuration SIP
        </h2>

        <div class="form-group">
          <label for="sipServer">Serveur SIP</label>
          <input type="text" id="sipServer" placeholder="sbc.interfone.co:5061" value="sbc.interfone.co:5061">
          <div class="help-text">üöÄ <strong>Version native</strong> : Connexion SIP UDP directe au serveur Interfone (comme Zoiper). Peut intercepter les vrais appels !</div>
        </div>

        <div class="form-group">
          <label for="sipUsername">Nom d'utilisateur SIP</label>
          <input type="text" id="sipUsername" placeholder="Votre identifiant SIP">
        </div>

        <div class="form-group">
          <label for="sipPassword">Mot de passe SIP</label>
          <input type="password" id="sipPassword" placeholder="Votre mot de passe SIP">
        </div>

        <div class="alert alert-info">
          üìã <strong>Identifiants requis :</strong> Pour que l'application puisse intercepter les vrais appels, vous devez utiliser vos identifiants Interfone r√©els (ceux que vous utilisez avec Zoiper).
          <br><br>
          üí° <strong>Test :</strong> Configurez d'abord Zoiper avec vos identifiants pour confirmer qu'ils fonctionnent, puis utilisez les m√™mes ici.
        </div>
      </div>

      <div class="section">
        <h2 class="section-title">
          <svg viewBox="0 0 24 24">
            <path d="M12 2L13.09 8.26L22 9L17 14L18.18 22L12 19L5.82 22L7 14L2 9L10.91 8.26L12 2z"/>
          </svg>
          Mise √† jour (v1.3.1) ‚ú®
        </h2>

        <div class="form-group">
          <div class="help-text" id="updateStatus">V√©rification des mises √† jour...</div>
          <div style="margin-top: 15px;">
            <button type="button" class="btn-secondary" onclick="checkForUpdates()" id="checkUpdateBtn">
              üîç V√©rifier les mises √† jour
            </button>
            <button type="button" class="btn-primary" onclick="installUpdate()" id="installUpdateBtn" style="display: none; margin-left: 10px;">
              üì• Installer la mise √† jour
            </button>
          </div>
          <div id="updateProgress" style="display: none; margin-top: 10px;">
            <div style="background: #f0f0f0; border-radius: 10px; height: 8px;">
              <div id="updateProgressBar" style="background: #667eea; height: 100%; border-radius: 10px; width: 0%; transition: width 0.3s;"></div>
            </div>
            <div id="updateProgressText" style="margin-top: 5px; font-size: 12px; color: #666;"></div>
          </div>
        </div>
      </div>

      <div class="section">
        <h2 class="section-title">
          <svg viewBox="0 0 24 24">
            <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
          </svg>
          Configuration Odoo
        </h2>

        <div class="form-group">
          <label for="odooUrl">URL Odoo</label>
          <input type="text" id="odooUrl" placeholder="https://votre-instance.odoo.com">
          <div class="help-text">URL de votre instance Odoo (sans /web)</div>
        </div>
      </div>

      <div class="buttons">
        <button class="btn-secondary" onclick="testCall()" id="testCallBtn">
          üìû Test appel
        </button>
        <button class="btn-primary" onclick="saveSettings()" id="saveBtn">
          Sauvegarder
        </button>
        <button class="btn-primary" onclick="toggleConnection()" id="connectBtn">
          Se connecter
          <span class="loader" id="loader"></span>
        </button>
      </div>

      <div class="production-ready">
        <div style="margin-top: 10px; font-size: 14px; color: #2563eb; text-align: center; font-weight: 500;">
          üéâ Version production : pr√™te √† intercepter les vrais appels Interfone !
        </div>
      </div>
    </div>
  </div>

  <script>
    // Gestion des mises √† jour
    async function checkForUpdates() {
      const btn = document.getElementById('checkUpdateBtn');
      const status = document.getElementById('updateStatus');

      btn.disabled = true;
      btn.textContent = 'üîç V√©rification...';
      status.textContent = 'V√©rification des mises √† jour...';

      try {
        await window.electronAPI.invoke('check-for-updates');
      } catch (error) {
        status.textContent = 'Erreur lors de la v√©rification: ' + error.message;
        btn.disabled = false;
        btn.textContent = 'üîç V√©rifier les mises √† jour';
      }
    }

    async function installUpdate() {
      try {
        await window.electronAPI.invoke('install-update');
      } catch (error) {
        console.error('Erreur installation:', error);
      }
    }

    // √âcouter les √©v√©nements de mise √† jour
    window.electronAPI.on('update-status', (event, data) => {
      const status = document.getElementById('updateStatus');
      const checkBtn = document.getElementById('checkUpdateBtn');
      const installBtn = document.getElementById('installUpdateBtn');
      const progress = document.getElementById('updateProgress');
      const progressBar = document.getElementById('updateProgressBar');
      const progressText = document.getElementById('updateProgressText');

      switch (data.status) {
        case 'checking':
          status.textContent = 'V√©rification des mises √† jour...';
          break;

        case 'available':
          status.textContent = `‚úÖ Mise √† jour disponible : v${data.version}`;
          installBtn.style.display = 'inline-block';
          checkBtn.disabled = false;
          checkBtn.textContent = 'üîç V√©rifier les mises √† jour';
          break;

        case 'not-available':
          status.textContent = `‚úÖ Vous avez la derni√®re version (v${data.version})`;
          checkBtn.disabled = false;
          checkBtn.textContent = 'üîç V√©rifier les mises √† jour';
          break;

        case 'downloading':
          status.textContent = 'üì• T√©l√©chargement en cours...';
          progress.style.display = 'block';
          progressBar.style.width = data.progress + '%';
          progressText.textContent = `${data.progress.toFixed(1)}% t√©l√©charg√©`;
          break;

        case 'downloaded':
          status.textContent = `‚úÖ Mise √† jour pr√™te √† installer (v${data.version})`;
          progress.style.display = 'none';
          installBtn.style.display = 'inline-block';
          break;

        case 'error':
          status.textContent = '‚ùå Erreur: ' + data.error;
          checkBtn.disabled = false;
          checkBtn.textContent = 'üîç V√©rifier les mises √† jour';
          break;
      }
    });

    // V√©rification automatique au chargement
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        checkForUpdates();
      }, 2000);
    });
  </script>
  <script src="renderer-native.js"></script>
</body>
</html>