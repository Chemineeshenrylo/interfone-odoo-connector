/*! For license information please see taskpane.js.LICENSE.txt */
!function(){var e={58394:function(e,t,n){"use strict";e.exports=n.p+"8bed1586e3aebf7324fd.css"}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.m=e,n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var a=r.length-1;a>-1&&(!e||!/^http(s?):/.test(e));)e=r[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e}(),n.b=document.baseURI||self.location.href,function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function n(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?t(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):t(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function r(e,t,n){return(t=o(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function o(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return c(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){i=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(i)throw o}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function i(){"use strict";i=function(){return n};var t,n={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function d(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(t){d=function(e,t,n){return e[t]=n}}function p(e,t,n,r){var a=t&&t.prototype instanceof b?t:b,s=Object.create(a.prototype),c=new C(r||[]);return o(s,"_invoke",{value:O(e,n,c)}),s}function m(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}n.wrap=p;var h="suspendedStart",f="suspendedYield",v="executing",g="completed",y={};function b(){}function w(){}function x(){}var E={};d(E,c,(function(){return this}));var k=Object.getPrototypeOf,I=k&&k(k(P([])));I&&I!==r&&a.call(I,c)&&(E=I);var _=x.prototype=b.prototype=Object.create(E);function S(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function T(t,n){function r(o,s,c,i){var u=m(t[o],t,s);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==e(d)&&a.call(d,"__await")?n.resolve(d.__await).then((function(e){r("next",e,c,i)}),(function(e){r("throw",e,c,i)})):n.resolve(d).then((function(e){l.value=e,c(l)}),(function(e){return r("throw",e,c,i)}))}i(u.arg)}var s;o(this,"_invoke",{value:function(e,t){function a(){return new n((function(n,a){r(e,t,n,a)}))}return s=s?s.then(a,a):a()}})}function O(e,n,r){var a=h;return function(o,s){if(a===v)throw Error("Generator is already running");if(a===g){if("throw"===o)throw s;return{value:t,done:!0}}for(r.method=o,r.arg=s;;){var c=r.delegate;if(c){var i=L(c,r);if(i){if(i===y)continue;return i}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===h)throw a=g,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=v;var u=m(e,n,r);if("normal"===u.type){if(a=r.done?g:f,u.arg===y)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(a=g,r.method="throw",r.arg=u.arg)}}}function L(e,n){var r=n.method,a=e.iterator[r];if(a===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,L(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var o=m(a,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,y;var s=o.arg;return s?s.done?(n[e.resultName]=s.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function j(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function B(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(j,this),this.reset(!0)}function P(n){if(n||""===n){var r=n[c];if(r)return r.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length)){var o=-1,s=function e(){for(;++o<n.length;)if(a.call(n,o))return e.value=n[o],e.done=!1,e;return e.value=t,e.done=!0,e};return s.next=s}}throw new TypeError(e(n)+" is not iterable")}return w.prototype=x,o(_,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:w,configurable:!0}),w.displayName=d(x,l,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,d(e,l,"GeneratorFunction")),e.prototype=Object.create(_),e},n.awrap=function(e){return{__await:e}},S(T.prototype),d(T.prototype,u,(function(){return this})),n.AsyncIterator=T,n.async=function(e,t,r,a,o){void 0===o&&(o=Promise);var s=new T(p(e,t,r,a),o);return n.isGeneratorFunction(t)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},S(_),d(_,l,"Generator"),d(_,c,(function(){return this})),d(_,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},n.values=P,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(B),!e)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,a){return c.type="throw",c.arg=e,n.next=r,a&&(n.method="next",n.arg=t),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],c=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var i=a.call(s,"catchLoc"),u=a.call(s,"finallyLoc");if(i&&u){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(i){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),B(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;B(n)}return a}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:P(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},n}function u(e,t,n,r,a,o,s){try{var c=e[o](s),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}function l(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){u(o,r,a,s,c,"next",e)}function c(e){u(o,r,a,s,c,"throw",e)}s(void 0)}))}}function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=(new Date).toISOString(),r="[".concat(n,"] ").concat(e);t?(console.group(r),console.log("Détails:",t),t instanceof Error&&console.log("Stack:",t.stack),console.groupEnd()):console.log(r)}Office.onReady((function(e){d("Office.onReady appelé",e),e.host===Office.HostType.Outlook&&(d("Application démarrée dans Outlook"),document.getElementById("sideload-msg").style.display="none",document.getElementById("app-body").style.display="block",l(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b();case 3:I(),_(),S(),j(),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),d("Erreur lors du chargement initial:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))())}));var p=document.createElement("style");function m(e){function t(e){return(e.match(/\d/g)||[]).length}function n(e){if(t(e)<6)return null;var n=e.trim().replace(/[\(\)]/g,"").replace(/[-\.]/g," ").replace(/\s+/g," ");return n.startsWith("00")&&(n="+"+n.slice(2)),{formatted:n,digitCount:t(n)}}for(var r=new Map,a=0,o=[/(?:\+|00)[1-9]\d{1,3}[- .]?\d(?:[- .]?\d){4,14}/g,/\d(?:[- .]?\d){5,14}/g];a<o.length;a++){var c,i=o[a],u=s(e.matchAll(i));try{for(u.s();!(c=u.n()).done;){var l=n(c.value[0]);l&&l.digitCount>=6&&(r.has(l.formatted)||r.set(l.formatted,l))}}catch(e){u.e(e)}finally{u.f()}}return Array.from(r.values())}function h(e){for(var t=document.getElementById("phone-select"),n=document.getElementById("phone-number");t.options.length>1;)t.remove(1);e.forEach((function(e,n){var r=document.createElement("option");r.value=e.formatted,r.textContent="Numéro ".concat(n+1,": ").concat(e.formatted),t.appendChild(r)})),e.length>0&&(n.value=e[0].formatted)}function f(e){var t=document.getElementById("attachments-list");if(t)if(t.innerHTML="",e&&0!==e.length){var n=document.createElement("ul");n.className="attachments-list",e.forEach((function(e,t){var r=document.createElement("li");r.className="attachment-item";var a=function(e){if(0===e)return"0 B";var t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]}(e.size);r.innerHTML='\n            <div class="attachment-info">\n                <span class="attachment-name">'.concat(e.name,'</span>\n                <span class="attachment-size">').concat(a,"</span>\n            </div>\n        "),n.appendChild(r)})),t.appendChild(n);var r=document.createElement("style");r.textContent="\n        .attachments-list {\n            list-style: none;\n            padding: 0;\n            margin: 0;\n        }\n        \n        .attachment-item {\n            padding: 8px;\n            border: 1px solid #ddd;\n            margin-bottom: 8px;\n            border-radius: 4px;\n            background-color: #f8f9fa;\n        }\n        \n        .attachment-info {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n        \n        .attachment-name {\n            font-weight: 500;\n            color: #333;\n        }\n        \n        .attachment-size {\n            color: #666;\n            font-size: 0.9em;\n        }\n        \n        .no-attachments {\n            color: #666;\n            font-style: italic;\n            text-align: center;\n            padding: 10px;\n        }\n    ",document.head.appendChild(r)}else t.innerHTML='<p class="no-attachments">Aucune pièce jointe</p>'}function v(){var e=document.getElementById("phone-number");document.getElementById("phone-select").addEventListener("change",(function(t){t.target.value&&(e.value=t.target.value)})),e.addEventListener("input",(function(e){var t=e.target.value;t=t.replace(/[^\d+\s]/g,""),e.target.value=t}))}function g(e){var t,n=new Map,r=s(e.matchAll(/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g));try{for(r.s();!(t=r.n()).done;){var a=t.value[0].toLowerCase().trim();if(!n.has(a)){var o=!a.split("@")[1].includes("cheminees");n.set(a,{email:a,isPriority:o})}}}catch(e){r.e(e)}finally{r.f()}return Array.from(n.values()).sort((function(e,t){return e.isPriority!==t.isPriority?e.isPriority?-1:1:e.email.localeCompare(t.email)}))}function y(e){for(var t=document.getElementById("email-select"),n=document.getElementById("sender-email");t.options.length>1;)t.remove(1);e.forEach((function(e,n){var r=document.createElement("option");r.value=e.email;var a=e.isPriority?"🔵":"⚪";r.textContent="".concat(a," Email ").concat(n+1,": ").concat(e.email),t.appendChild(r)})),e.length>0&&(n.value=e[0].email)}function b(){return w.apply(this,arguments)}function w(){return(w=l(i().mark((function e(){var t,n,r,a,o,c,u,l,p,b,w,I;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d("Chargement des données de l'email"),!(t=Office.context.mailbox.item)){e.next=65;break}if(v(),!(t.attachments&&t.attachments.length>0)){e.next=42;break}d("Nombre de pièces jointes trouvées:",t.attachments.length),window.attachmentsToUpload=[],n=s(t.attachments),e.prev=8,n.s();case 10:if((r=n.n()).done){e.next=30;break}if(!(a=r.value).isInline){e.next=14;break}return e.abrupt("continue",28);case 14:return e.prev=14,x(a.name,"progress","Récupération en cours..."),e.next=18,E(a.id);case 18:o=e.sent,window.attachmentsToUpload.push({name:a.name,datas:o,mimetype:a.contentType||"application/octet-stream",res_model:"crm.lead",type:"binary"}),x(a.name,"success"),d("Pièce jointe préparée:",{name:a.name,type:a.contentType,size:a.size}),e.next=28;break;case 24:e.prev=24,e.t0=e.catch(14),d("Erreur lors du traitement de la pièce jointe:",e.t0),x(a.name,"error",e.t0.message);case 28:e.next=10;break;case 30:e.next=35;break;case 32:e.prev=32,e.t1=e.catch(8),n.e(e.t1);case 35:return e.prev=35,n.f(),e.finish(35);case 38:f(t.attachments.filter((function(e){return!e.isInline}))),d("Pièces jointes préparées:",window.attachmentsToUpload.length),e.next=45;break;case 42:d("Aucune pièce jointe trouvée"),f([]),window.attachmentsToUpload=[];case 45:return e.prev=45,e.next=48,new Promise((function(e,n){t.body.getAsync(Office.CoercionType.Text,(function(t){t.status===Office.AsyncResultStatus.Succeeded?e(t):n(new Error("Échec du chargement du corps du message"))}))}));case 48:c=e.sent,u=c.value,document.getElementById("email-body").value=u,d("Numéros de téléphone détectés:",l=m(u)),h(l),d("Emails détectés:",p=g(u)),y(p),e.next=62;break;case 59:e.prev=59,e.t2=e.catch(45),d("Erreur lors du chargement du corps du message:",e.t2);case 62:t.sender&&(b=t.sender.emailAddress,w=t.sender.displayName,b=k(b),w=w||b.split("@")[0],document.getElementById("sender-name").value=w,document.getElementById("sender-email").value=b),I=t.subject||"",document.getElementById("email-subject").value=I;case 65:case"end":return e.stop()}}),e,null,[[8,32,35,38],[14,24],[45,59]])})))).apply(this,arguments)}function x(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=document.getElementById("progress-container")||function(){var e=document.createElement("div");e.id="progress-container",e.style.cssText="\n        position: fixed;\n        bottom: 20px;\n        right: 20px;\n        width: 300px;\n        max-height: 80vh;\n        overflow-y: auto;\n        z-index: 1000;\n    ";var t=document.createElement("style");return t.textContent="\n        .file-progress {\n            margin: 10px;\n            padding: 10px;\n            border-radius: 4px;\n            background: #f8f9fa;\n            border: 1px solid #ddd;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n        }\n        .file-progress.progress {\n            background: #e8f4f8;\n            border-color: #b8daff;\n        }\n        .file-progress.success {\n            background: #d4edda;\n            border-color: #c3e6cb;\n        }\n        .file-progress.error {\n            background: #f8d7da;\n            border-color: #f5c6cb;\n        }\n        .filename {\n            display: block;\n            font-weight: bold;\n            margin-bottom: 5px;\n            word-break: break-all;\n        }\n        .status {\n            display: block;\n            font-size: 0.9em;\n            color: #666;\n        }\n        .spinner {\n            margin-top: 5px;\n            width: 20px;\n            height: 20px;\n            border: 2px solid #ccc;\n            border-top-color: #007bff;\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n        }\n        @keyframes spin {\n            to { transform: rotate(360deg); }\n        }\n    ",document.head.appendChild(t),document.body.appendChild(e),e}(),a=r.querySelector('[data-file="'.concat(e,'"]'))||function(e){var t=document.createElement("div");return t.className="file-progress",t.dataset.file=e,document.getElementById("progress-container").appendChild(t),t}(e);switch(t){case"progress":a.className="file-progress progress",a.innerHTML='\n                <span class="filename">'.concat(e,'</span>\n                <span class="status">').concat(n,'</span>\n                <div class="spinner"></div>\n            ');break;case"success":a.className="file-progress success",a.innerHTML='\n                <span class="filename">'.concat(e,'</span>\n                <span class="status">Traitement terminé ✓</span>\n            '),setTimeout((function(){return a.remove()}),3e3);break;case"error":a.className="file-progress error",a.innerHTML='\n                <span class="filename">'.concat(e,'</span>\n                <span class="status">Erreur: ').concat(n,"</span>\n            ")}}function E(e){return new Promise((function(t,n){Office.context.mailbox.item.getAttachmentContentAsync(e,(function(e){e.status===Office.AsyncResultStatus.Succeeded?t(e.value.content):n(new Error("Échec de récupération de la pièce jointe: ".concat(e.error.message)))}))}))}function k(e){return e?((e=(e=e.replace(/<mailto:/g,"").replace(/>/g,"")).trim()).includes(" ")&&(e=e.split(" ")[0]),e):""}function I(){d("Chargement des données de l'utilisateur");var e=Office.context.mailbox.userProfile;if(e){var t=e.emailAddress;document.getElementById("user-email").value=t,d("Email de l'utilisateur chargé:",t)}else d("Profil utilisateur non disponible")}function _(){d("Chargement des réglages sauvegardés");try{var e=localStorage.getItem("odooSettings");if(e){var t=JSON.parse(e);d("Réglages trouvés",{hasUrl:!!t.odooUrl,hasDatabase:!!t.database,hasUsername:!!t.username,hasPassword:!!t.password}),document.getElementById("odoo-url").value=t.odooUrl||"",document.getElementById("database").value=t.database||"",document.getElementById("username").value=t.username||"",document.getElementById("password").value=t.password||""}else d("Aucun réglage sauvegardé trouvé")}catch(e){d("Erreur lors du chargement des réglages",e)}}function S(){var e=document.getElementById("password"),t=document.getElementById("toggle-password");e&&t&&t.addEventListener("click",(function(){var n="password"===e.type?"text":"password";e.type=n;var r=t.querySelector("i");"password"===n?r.classList.replace("ms-Icon--Hide","ms-Icon--RedEye"):r.classList.replace("ms-Icon--RedEye","ms-Icon--Hide")}))}p.textContent="\n    .phone-input-container {\n        position: relative;\n        display: flex;\n        gap: 8px;\n    }\n    \n    #phone-number {\n        flex: 1;\n        padding: 8px;\n        border: 1px solid #ddd;\n        border-radius: 4px;\n    }\n    \n    #phone-select {\n        width: auto;\n        min-width: 120px;\n        padding: 8px;\n        border: 1px solid #ddd;\n        border-radius: 4px;\n        background-color: #f8f9fa;\n    }\n",document.head.appendChild(p);var T=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var t=this.getSettings();this.host=t.odooUrl,this.db=t.database,this.username=t.username,this.password=t.password,this.worker_url="https://royal-pond-be25.lvr-3b7.workers.dev",this.maxRetries=3,this.retryDelay=1e3,d("OdooAPI initialisée",{host:this.host,database:this.db,username:this.username,worker_url:this.worker_url})},t=[{key:"getSettings",value:function(){var e=localStorage.getItem("odooSettings");if(!e)throw new Error("Aucun réglage trouvé. Veuillez configurer l'add-in dans les paramètres.");var t=JSON.parse(e);if(!(t.odooUrl&&t.database&&t.username&&t.password))throw new Error("Configuration incomplète. Veuillez vérifier vos paramètres.");return t}},{key:"formatOdooUrl",value:function(e){return e.startsWith("http://")||e.startsWith("https://")||(e="https://"+e),e.replace(/\/$/,"")}},{key:"retryRequest",value:(v=l(i().mark((function e(t){var n,r,a,o=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=i().mark((function e(n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t();case 3:return e.t0=e.sent,e.abrupt("return",{v:e.t0});case 7:if(e.prev=7,e.t1=e.catch(0),d("Tentative ".concat(n+1,"/").concat(o.maxRetries," échouée"),e.t1),n!==o.maxRetries-1){e.next=12;break}throw e.t1;case 12:return e.next=14,new Promise((function(e){return setTimeout(e,o.retryDelay*(n+1))}));case 14:case"end":return e.stop()}}),e,null,[[0,7]])})),a=0;case 2:if(!(a<this.maxRetries)){e.next=10;break}return e.delegateYield(n(a),"t0",4);case 4:if(!(r=e.t0)){e.next=7;break}return e.abrupt("return",r.v);case 7:a++,e.next=2;break;case 10:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"escapeXml",value:function(e){return"string"!=typeof e?e:e.replace(/[<>&'"]/g,(function(e){switch(e){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;";default:return e}})).replace(/[\x00-\x1F\x7F-\x9F]/g,"").trim()}},{key:"createLead",value:(f=l(i().mark((function e(t,n,r){var a,o,c,u,l,p,m,h,f,v,g,y,b;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getUserId();case 3:return a=e.sent,o=document.getElementById("sender-name").value.trim(),c=document.getElementById("phone-number").value.trim(),d("Données nettoyées pour création lead:",u={name:this.escapeXml(n||"Nouveau lead"),email_from:this.escapeXml(t),description:this.escapeXml(r),user_id:a,type:"opportunity",active:!0,company_id:1,stage_id:16,contact_name:this.escapeXml(o||t.split("@")[0]),phone:this.escapeXml(c)}),e.next=10,this.fetchWithTimeout("".concat(this.worker_url,"/create_lead"),{method:"POST",headers:this.buildHeaders(),body:JSON.stringify({odoo_url:this.host,database:this.db,username:this.username,password:this.password,lead_data:u})});case 10:return l=e.sent,e.next=13,l.text();case 13:d("Réponse brute création lead:",p=e.sent),e.prev=15,m=JSON.parse(p),e.next=22;break;case 19:throw e.prev=19,e.t0=e.catch(15),new Error("Réponse invalide du serveur: ".concat(p));case 22:if(m.success){e.next=24;break}throw new Error(m.error||"Réponse serveur indique un échec");case 24:if(h=m.lead_id,!(window.attachmentsToUpload&&window.attachmentsToUpload.length>0)){e.next=61;break}d("Début upload des pièces jointes (".concat(window.attachmentsToUpload.length,")")),f=s(window.attachmentsToUpload),e.prev=28,f.s();case 30:if((v=f.n()).done){e.next=53;break}return g=v.value,e.prev=32,d("Début upload pièce jointe:",{name:g.name,size:g.datas.length}),e.next=36,this.fetchWithTimeout("".concat(this.worker_url,"/create_attachment"),{method:"POST",headers:this.buildHeaders(),body:JSON.stringify({odoo_url:this.host,database:this.db,username:this.username,password:this.password,attachment_data:{name:g.name,datas:g.datas,res_model:"crm.lead",res_id:h,mimetype:g.mimetype,type:"binary"}})},6e4);case 36:return y=e.sent,e.next=39,y.json();case 39:if((b=e.sent).success){e.next=42;break}throw new Error(b.error||"Échec de création de la pièce jointe");case 42:d("Pièce jointe uploadée avec succès:",{name:g.name,id:b.attachment_id}),x(g.name,"success","Upload terminé"),e.next=51;break;case 46:throw e.prev=46,e.t1=e.catch(32),d("Erreur upload pièce jointe:",{name:g.name,error:e.t1.message}),x(g.name,"error",e.t1.message),e.t1;case 51:e.next=30;break;case 53:e.next=58;break;case 55:e.prev=55,e.t2=e.catch(28),f.e(e.t2);case 58:return e.prev=58,f.f(),e.finish(58);case 61:return e.abrupt("return",{success:!0,leadId:h,message:"Lead et références des pièces jointes créés avec succès",details:m});case 64:throw e.prev=64,e.t3=e.catch(0),d("Erreur détaillée création lead:",e.t3),e.t3;case 68:case"end":return e.stop()}}),e,this,[[0,64],[15,19],[28,55,58,61],[32,46]])}))),function(e,t,n){return f.apply(this,arguments)})},{key:"createAttachment",value:(h=l(i().mark((function e(t){var r,a,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,d("Création pièce jointe:",{model:(r=n(n({},t),{},{res_model:t.res_model||"crm.lead"})).res_model,resId:r.res_id,fileName:r.name}),e.next=5,this.fetchWithTimeout("".concat(this.worker_url,"/create_attachment"),{method:"POST",headers:this.buildHeaders(),body:JSON.stringify({odoo_url:this.host,database:this.db,username:this.username,password:this.password,attachment_data:r})},6e4);case 5:return a=e.sent,e.next=8,a.json();case 8:if((o=e.sent).success){e.next=11;break}throw new Error(o.error||"Échec de création de la pièce jointe");case 11:return d("Pièce jointe créée avec succès:",{attachmentId:o.attachment_id,model:r.res_model,resId:r.res_id}),e.abrupt("return",{success:!0,attachment_id:o.attachment_id});case 15:throw e.prev=15,e.t0=e.catch(0),d("Erreur création pièce jointe:",e.t0),e.t0;case 19:case"end":return e.stop()}}),e,this,[[0,15]])}))),function(e){return h.apply(this,arguments)})},{key:"getUserId",value:(m=l(i().mark((function e(){var t,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchWithTimeout("".concat(this.worker_url,"/get_user_id"),{method:"POST",headers:this.buildHeaders(),body:JSON.stringify({odoo_url:this.host,database:this.db,username:this.username,password:this.password})});case 3:if((t=e.sent).ok){e.next=6;break}throw new Error("Erreur HTTP ".concat(t.status));case 6:return e.next=8,t.json();case 8:if((n=e.sent).success&&n.user_id){e.next=11;break}throw new Error("Impossible de récupérer l'ID utilisateur");case 11:return e.abrupt("return",n.user_id);case 14:throw e.prev=14,e.t0=e.catch(0),new Error("Erreur lors de la récupération de l'ID utilisateur: ".concat(e.t0.message));case 17:case"end":return e.stop()}}),e,this,[[0,14]])}))),function(){return m.apply(this,arguments)})},{key:"uploadLargeAttachment",value:(p=l(i().mark((function e(t,n){var r,a,o,s,c,u,l,p,m,h;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=512e3,a=Math.ceil(n.datas.length/r),o=null,d("Début upload par chunks pour ".concat(n.name),{totalSize:n.datas.length,chunks:a}),s=0;case 5:if(!(s<a)){e.next=29;break}return c=s*r,u=Math.min(c+r,n.datas.length),l=n.datas.slice(c,u),p=s===a-1,e.prev=10,e.next=13,this.fetchWithTimeout("".concat(this.worker_url,"/upload_attachment_chunk"),{method:"POST",headers:this.buildHeaders(),body:JSON.stringify({odoo_url:this.host,database:this.db,username:this.username,password:this.password,attachment_data:{name:n.name,datas:l,res_model:"crm.lead",res_id:t,mimetype:n.mimetype,chunk_index:s,total_chunks:a,is_last_chunk:p,attachment_id:o}})},15e3);case 13:return m=e.sent,e.next=16,m.json();case 16:if((h=e.sent).success){e.next=19;break}throw new Error(h.error||"Échec upload chunk");case 19:0===s&&(o=h.attachment_id),x(n.name,"progress","Upload en cours... ".concat(Math.round((s+1)/a*100),"%")),e.next=26;break;case 23:throw e.prev=23,e.t0=e.catch(10),new Error("Erreur chunk ".concat(s+1,"/").concat(a,": ").concat(e.t0.message));case 26:s++,e.next=5;break;case 29:return e.abrupt("return",o);case 30:case"end":return e.stop()}}),e,this,[[10,23]])}))),function(e,t){return p.apply(this,arguments)})},{key:"testServerConnection",value:(u=l(i().mark((function e(){var t=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d("Test de connexion au serveur",{url:this.worker_url,odoo_url:this.host}),e.abrupt("return",this.retryRequest(l(i().mark((function e(){var n,r,a,o,s,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.fetchWithTimeout("".concat(t.worker_url,"/test"),{method:"POST",headers:t.buildHeaders(),body:JSON.stringify({odoo_url:t.host,database:t.db,username:t.username,password:t.password})});case 3:if((a=e.sent).ok){e.next=9;break}return e.next=7,a.json().catch((function(){return{}}));case 7:throw o=e.sent,new Error(o.error||"Erreur HTTP ".concat(a.status));case 9:return e.next=11,a.json();case 11:if(d("Réponse du test de connexion",s=e.sent),(null===(n=s.details)||void 0===n||null===(n=n.login_response)||void 0===n?void 0:n.includes("<value><int>"))||(null===(r=s.details)||void 0===r||null===(r=r.login_response)||void 0===r?void 0:r.includes("<value><boolean>1</boolean>"))){e.next=16;break}throw new Error("Échec de l'authentification. Vérifiez vos identifiants de connexion.");case 16:return c=t.extractVersionInfo(s.details.version_response),e.abrupt("return",{success:!0,message:"Connexion établie avec succès (Odoo ".concat(c.version,")"),details:{version:c,responses:s.details}});case 20:return e.prev=20,e.t0=e.catch(0),e.abrupt("return",t.handleError(e.t0,"Erreur lors du test de connexion"));case 23:case"end":return e.stop()}}),e,null,[[0,20]])})))));case 2:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"searchPartners",value:(c=l(i().mark((function e(t){var n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchWithTimeout("".concat(this.worker_url,"/search_partners"),{method:"POST",headers:this.buildHeaders(),body:JSON.stringify({odoo_url:this.host,database:this.db,username:this.username,password:this.password,search_criteria:t})});case 3:return n=e.sent,e.next=6,n.json();case 6:if((r=e.sent).success){e.next=9;break}throw new Error(r.error||"Échec de la recherche");case 9:return e.abrupt("return",r.partners);case 12:throw e.prev=12,e.t0=e.catch(0),d("Erreur recherche partenaires:",e.t0),e.t0;case 16:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(e){return c.apply(this,arguments)})},{key:"extractVersionInfo",value:function(e){try{var t=e.match(/<name>server_version<\/name>\s*<value><string>(.*?)<\/string><\/value>/),n=t?t[1]:"Version inconnue",r=e.match(/<name>server_serie<\/name>\s*<value><string>(.*?)<\/string><\/value>/);return{version:n,serie:r?r[1]:""}}catch(e){return d("Erreur extraction version",e),{version:"Version inconnue",serie:"Inconnue"}}}},{key:"validateCredentials",value:function(){if(!this.host||!this.db||!this.password)throw new Error("Configuration incomplète: tous les paramètres de connexion sont requis")}},{key:"init",value:(o=l(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.validateCredentials(),this.host=this.formatOdooUrl(this.host),e.next=5,this.testServerConnection();case 5:if((t=e.sent).success){e.next=8;break}throw new Error("Échec de l'initialisation: ".concat(t.message));case 8:return d("Initialisation réussie",t),e.abrupt("return",t);case 12:throw e.prev=12,e.t0=e.catch(0),d("Erreur lors de l'initialisation",e.t0),e.t0;case 16:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(){return o.apply(this,arguments)})},{key:"buildHeaders",value:function(){return{"Content-Type":"application/json","X-Api-Key":this.password}}},{key:"fetchWithTimeout",value:(r=l(i().mark((function e(t,r){var a,o,s,c,u=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=u.length>2&&void 0!==u[2]?u[2]:3e4,o=new AbortController,s=setTimeout((function(){return o.abort()}),a),e.prev=3,e.next=6,fetch(t,n(n({},r),{},{signal:o.signal}));case 6:return c=e.sent,clearTimeout(s),e.abrupt("return",c);case 11:if(e.prev=11,e.t0=e.catch(3),clearTimeout(s),"AbortError"!==e.t0.name){e.next=16;break}throw new Error("La requête a pris trop de temps");case 16:throw e.t0;case 17:case"end":return e.stop()}}),e,null,[[3,11]])}))),function(e,t){return r.apply(this,arguments)})},{key:"handleError",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Une erreur est survenue";return d("Erreur API",e),{success:!1,message:e.message||t,details:{error:e.message,type:e.name}}}}],t&&a(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r,o,c,u,p,m,h,f,v}();function O(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=document.createElement("div");r.className="notification ".concat(t);var a=document.createElement("div");if(a.className="notification-message",a.textContent=e,r.appendChild(a),"success"===t&&n&&n.leadId){var o=JSON.parse(localStorage.getItem("odooSettings")),s=document.createElement("a");s.href="".concat(o.odooUrl,"/web#id=").concat(n.leadId,"&model=crm.lead&view_type=form"),s.target="_blank",s.className="opportunity-link",s.textContent="Voir l'opportunité dans Odoo",r.appendChild(s)}if(n){var c=document.createElement("div");if(c.className="notification-details",n.message){var i=document.createElement("div");i.className="error-message",i.textContent="Message: ".concat(n.message),c.appendChild(i)}if(n.logs&&n.logs.length>0){var u=document.createElement("div");u.className="error-logs",n.logs.forEach((function(e){var t=document.createElement("div");t.className="log-entry",t.textContent="".concat(e.timestamp||""," ").concat(e.message||e),u.appendChild(t)})),c.appendChild(u)}if(n.stack){var l=document.createElement("pre");l.className="error-stack",l.textContent=n.stack,c.appendChild(l)}r.appendChild(c)}var d=document.createElement("style");d.textContent="\n        .notification {\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            max-width: 80vw;\n            max-height: 80vh;\n            overflow-y: auto;\n            padding: 15px;\n            background: white;\n            border-radius: 5px;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n            z-index: 1000;\n            font-family: monospace;\n        }\n        .notification.error { border-left: 4px solid #f44336; }\n        .notification.success { border-left: 4px solid #4CAF50; }\n        .notification-message {\n            font-weight: bold;\n            margin-bottom: 10px;\n        }\n        .opportunity-link {\n            display: block;\n            margin: 10px 0;\n            padding: 8px 12px;\n            background-color: #4CAF50;\n            color: white;\n            text-decoration: none;\n            border-radius: 4px;\n            text-align: center;\n            font-weight: bold;\n            transition: background-color 0.3s;\n        }\n        .opportunity-link:hover {\n            background-color: #45a049;\n        }\n        .notification-details {\n            font-size: 12px;\n            margin-top: 10px;\n            padding-top: 10px;\n            border-top: 1px solid #eee;\n        }\n        .error-message {\n            color: #f44336;\n            margin-bottom: 5px;\n        }\n        .error-logs {\n            margin-top: 5px;\n            padding: 5px;\n            background: #f5f5f5;\n            border-radius: 3px;\n        }\n        .log-entry {\n            padding: 2px 5px;\n            border-bottom: 1px solid #eee;\n        }\n        .error-stack {\n            margin-top: 5px;\n            padding: 5px;\n            background: #f5f5f5;\n            overflow-x: auto;\n            font-size: 11px;\n        }\n    ",document.head.appendChild(d),document.body.appendChild(r),setTimeout((function(){r.remove()}),3e4)}function L(e){var t=document.getElementById("app-body"),n=document.getElementById("settings-page"),r=document.getElementById("search-page");switch(t.classList.remove("slide-left"),n.classList.remove("active"),r.classList.remove("active"),e){case"settings-page":t.classList.add("slide-left"),n.classList.add("active");break;case"search-page":t.classList.add("slide-left"),r.classList.add("active")}}function j(){var e=["sender-email","email-subject"],t=document.getElementById("save-to-crm");function n(){var n=e.every((function(e){var t=document.getElementById(e);return t&&""!==t.value.trim()}));t.disabled=!n}e.forEach((function(e){var t=document.getElementById(e);t&&(t.addEventListener("input",n),t.addEventListener("change",n))})),n()}document.getElementById("test-connection").onclick=l(i().mark((function e(){var t,n,r,a,o,s,c,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=this).querySelector("i"),n=document.getElementById("odoo-url").value.trim(),r=document.getElementById("database").value.trim(),a=document.getElementById("username").value.trim(),o=document.getElementById("password").value.trim(),d("Test de connexion initié",{url:n,database:r,username:a,hasPassword:!!o}),n&&r&&a&&o){e.next=10;break}return O("Veuillez remplir tous les champs","error"),e.abrupt("return");case 10:return t.disabled=!0,t.textContent,t.innerHTML='<i class="ms-Icon ms-Icon--Sync"></i>Test en cours...',e.prev=13,s={odooUrl:n,database:r,username:a,password:o},localStorage.setItem("odooSettings",JSON.stringify(s)),c=new T,e.next=19,c.testServerConnection();case 19:if(!(u=e.sent).success){e.next=24;break}O(u.message,"success",u.details),e.next=25;break;case 24:throw new Error(u.message);case 25:e.next=31;break;case 27:e.prev=27,e.t0=e.catch(13),d("Erreur critique",e.t0),O(e.t0.message,"error",{"Type d'erreur":e.t0.name,"Détails":e.t0.stack||e.t0.message});case 31:return e.prev=31,t.disabled=!1,t.innerHTML='<i class="ms-Icon ms-Icon--PlugConnected"></i>Tester la connexion',e.finish(31);case 35:case"end":return e.stop()}}),e,this,[[13,27,31,35]])}))),document.getElementById("settings-button").addEventListener("click",(function(){L("settings-page"),document.getElementById("back-button").classList.add("visible")})),document.getElementById("back-button").addEventListener("click",(function(){L("app-body"),document.getElementById("back-button").classList.remove("visible")})),document.getElementById("search-button").addEventListener("click",l(i().mark((function e(){var t,n,r,a,o,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,L("search-page"),document.getElementById("back-button").classList.add("visible"),!(t=Office.context.mailbox.item)){e.next=23;break}return t.sender&&(n=k(n=t.sender.emailAddress),document.getElementById("search-sender-email").value=n),e.prev=6,e.next=9,new Promise((function(e,n){t.body.getAsync(Office.CoercionType.Text,(function(t){t.status===Office.AsyncResultStatus.Succeeded?e(t):n(new Error("Échec du chargement du corps du message"))}))}));case 9:for(r=e.sent,a=r.value,d("Numéros de téléphone détectés pour la recherche:",o=m(a)),s=document.getElementById("search-phone-select");s.options.length>1;)s.remove(1);o.forEach((function(e,t){var n=document.createElement("option");n.value=e.formatted,n.textContent="Numéro ".concat(t+1,": ").concat(e.formatted),s.appendChild(n)})),o.length>0&&(document.getElementById("search-phone-number").value=o[0].formatted),e.next=23;break;case 19:throw e.prev=19,e.t0=e.catch(6),d("Erreur lors du chargement du corps du message:",e.t0),e.t0;case 23:e.next=29;break;case 25:e.prev=25,e.t1=e.catch(0),console.error("Erreur lors du chargement des données:",e.t1),O("Erreur lors du chargement des données","error",{message:e.t1.message});case 29:case"end":return e.stop()}}),e,null,[[0,25],[6,19]])})))),document.getElementById("search-phone-select").addEventListener("change",(function(e){e.target.value&&(document.getElementById("search-phone-number").value=e.target.value)})),document.getElementById("search-contact-btn").addEventListener("click",l(i().mark((function e(){var t,r,a,o,c,u,d,p,m,h;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById("search-contact-btn"),r=document.getElementById("search-results"),e.prev=2,t.disabled=!0,t.innerHTML='<i class="ms-Icon ms-Icon--Sync"></i>Recherche en cours...',a=document.getElementById("search-email-checkbox").checked,o=document.getElementById("search-phone-checkbox").checked,c={},a&&(u=document.getElementById("search-sender-email").value.trim())&&(c.email=u),o&&(d=(d=document.getElementById("search-phone-number").value.trim()).replace(/[^0-9+]/g,""))&&(c.phone=d),0!==Object.keys(c).length){e.next=13;break}return O("Veuillez sélectionner et remplir au moins un critère de recherche","error"),e.abrupt("return");case 13:return p=new T,e.next=16,p.searchPartners(c);case 16:m=e.sent,r.innerHTML="",0===m.length?r.innerHTML='\n                <div class="no-results">\n                    Aucun contact trouvé avec ces critères\n                </div>\n            ':((h=document.createElement("div")).className="partner-cards",m.forEach((function(e){var t=document.createElement("div");t.className="partner-card",t.innerHTML='\n                    <div class="card-header">\n                        <input type="checkbox" class="partner-select" data-partner-id="'.concat(e.id,'">\n                        <h3 class="partner-name">').concat(e.name,'</h3>\n                    </div>\n                    <div class="card-content">\n                        <p class="partner-street">').concat(e.street||"",'</p>\n                        <p class="partner-city">').concat(e.zip||""," ").concat(e.city||"",'</p>\n                    </div>\n                    <div class="card-footer">\n                        <a href="').concat(p.host,"/web#id=").concat(e.id,'&model=res.partner&view_type=form" \n                           target="_blank" \n                           class="view-button">\n                           Voir dans Odoo\n                        </a>\n                        <button class="upload-button" style="display: none;" data-partner-id="').concat(e.id,'">\n                            <i class="ms-Icon ms-Icon--Upload"></i> Upload\n                        </button>\n                    </div>\n                '),h.appendChild(t)})),r.appendChild(h),document.querySelectorAll(".partner-select").forEach((function(e){e.addEventListener("change",(function(){this.closest(".partner-card").querySelector(".upload-button").style.display=this.checked?"block":"none"}))})),document.querySelectorAll(".upload-button").forEach((function(e){e.addEventListener("click",l(i().mark((function e(){var t,r,a,o,c,u,l,d;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.dataset.partnerId,r=this.innerHTML,e.prev=2,this.disabled=!0,this.innerHTML='<i class="ms-Icon ms-Icon--Sync"></i> Upload en cours...',window.attachmentsToUpload&&0!==window.attachmentsToUpload.length){e.next=8;break}return O("Aucune pièce jointe à uploader","error"),e.abrupt("return");case 8:a=new T,o=s(window.attachmentsToUpload),e.prev=10,o.s();case 12:if((c=o.n()).done){e.next=33;break}return u=c.value,e.prev=14,l=n(n({},u),{},{res_model:"res.partner",res_id:parseInt(t)}),x(u.name,"progress","Upload en cours..."),e.next=19,a.createAttachment(l);case 19:if(!(d=e.sent).success){e.next=24;break}x(u.name,"success","Upload terminé"),e.next=25;break;case 24:throw new Error(d.error||"Échec de l'upload");case 25:e.next=31;break;case 27:throw e.prev=27,e.t0=e.catch(14),x(u.name,"error",e.t0.message),e.t0;case 31:e.next=12;break;case 33:e.next=38;break;case 35:e.prev=35,e.t1=e.catch(10),o.e(e.t1);case 38:return e.prev=38,o.f(),e.finish(38);case 41:O("Pièces jointes uploadées avec succès","success"),this.closest(".partner-card").querySelector(".partner-select").checked=!1,this.style.display="none",e.next=51;break;case 48:e.prev=48,e.t2=e.catch(2),O("Erreur lors de l'upload des pièces jointes","error",{message:e.t2.message});case 51:return e.prev=51,this.disabled=!1,this.innerHTML=r,e.finish(51);case 55:case"end":return e.stop()}}),e,this,[[2,48,51,55],[10,35,38,41],[14,27]])}))))}))),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(2),O("Erreur lors de la recherche","error",{message:e.t0.message});case 24:return e.prev=24,t.disabled=!1,t.innerHTML='<i class="ms-Icon ms-Icon--Search"></i>Chercher le contact',e.finish(24);case 28:case"end":return e.stop()}}),e,null,[[2,21,24,28]])})))),document.getElementById("save-to-crm").onclick=l(i().mark((function e(){var t,n,r,a,o,s,c,u,l,p,m;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(t=this).innerHTML,e.prev=2,t.disabled=!0,t.innerHTML='<i class="ms-Icon ms-Icon--Sync"></i>Création en cours...',r=document.getElementById("sender-email").value.trim(),document.getElementById("sender-name").value.trim(),a=document.getElementById("email-subject").value.trim(),o=document.getElementById("email-body").value,s=document.getElementById("additional-notes").value.trim(),r&&a){e.next=12;break}throw new Error("L'email de l'expéditeur et le sujet sont requis");case 12:return c=new T,u='<div style="font-family: Arial, sans-serif;">',u+=o.split("\n").map((function(e){return'<p style="margin: 0 0 1em 0;">'.concat(e.trim(),"</p>")})).join(""),u+="</div>",s&&(u+='<div style="margin: 30px 0;">',u+='<hr style="border: none; border-top: 1px solid #cccccc;">',u+="<h3>Notes additionnelles :</h3>",u+='<hr style="border: none; border-top: 1px solid #cccccc;">',u+=s.split("\n").map((function(e){return'<p style="margin: 0 0 1em 0;">'.concat(e.trim(),"</p>")})).join(""),u+="</div>"),e.next=19,c.createLead(r,a,u);case 19:if(!(l=e.sent).success){e.next=26;break}p=JSON.parse(localStorage.getItem("odooSettings")),m=p.odooUrl,O("Lead créé avec succès dans Odoo","success",{leadId:l.leadId,message:l.message,logs:l.details,odooUrl:m}),e.next=27;break;case 26:throw new Error("Échec de la création du lead");case 27:e.next=34;break;case 29:e.prev=29,e.t0=e.catch(2),d("Erreur complète:",e.t0),O("Erreur lors de la création du lead","error",{message:e.t0.message,type:e.t0.name,details:e.t0.details||{},logs:e.t0.logs||[],stack:e.t0.stack});case 34:return e.prev=34,t.disabled=!1,t.innerHTML=n,e.finish(34);case 38:case"end":return e.stop()}}),e,this,[[2,29,34,38]])}))),document.getElementById("save-settings").onclick=function(){var e={odooUrl:document.getElementById("odoo-url").value.trim(),database:document.getElementById("database").value.trim(),username:document.getElementById("username").value.trim(),password:document.getElementById("password").value.trim()};if(d("Sauvegarde des réglages",{hasUrl:!!e.odooUrl,hasDatabase:!!e.database,hasUsername:!!e.username,hasPassword:!!e.password}),e.odooUrl&&e.database&&e.username&&e.password)try{localStorage.setItem("odooSettings",JSON.stringify(e)),O("Réglages sauvegardés avec succès !","success")}catch(e){d("Erreur sauvegarde réglages",e),O("Erreur lors de la sauvegarde des réglages","error")}else O("Veuillez remplir tous les champs","error")}}(),function(){"use strict";new URL(n(58394),n.b)}()}();
//# sourceMappingURL=taskpane.js.map